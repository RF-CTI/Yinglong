{% extends 'base.html' %}
{% block self_style %}
    <link rel="stylesheet" href="{{ url_for('static', filename="css/login.css") }}">
{% endblock self_style %}
    
</head>
{% block header %}
    <div class="row" style="width: 100%">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <header>
                <img src="{{ url_for('static', filename='image/redflags.png') }}" style="margin: 20px;height: 60px">
            </header>
        </div>
        <div class="col-md-2"></div>
    </div>
{% endblock header %}

{% block main_body %}
<div class="row">
    <div class="col-md-6 offset-md-6 col-sm-12">
        <div class="login_cart">
            <form>
                <div class="form-group">
                    <label for="exampleInputEmail1">Email address</label>
                    <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">Password</label>
                    <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
                </div>
                <div class="form-group row">
                    <div class='col-sm-6'>
                        <div class="form-check ">
                            <input type="checkbox" class="form-check-input" id="exampleCheck1">
                            <label class="form-check-label" for="exampleCheck1">Check me out</label>
                        </div>
                    </div>
                    <small id="forgetHelp" class="form-text text-muted col-sm-4 ml-auto"><a href='/forget/'>Forget password</a>.</small>
                </div>
                <button type="submit" class="btn btn-warning">Login</button>
                <small id="registerHelp" class="form-text text-muted">No account? Go to <a href='/register/'>register</a>.</small>
            </form>
        </div>
    </div>
</div>
{% endblock main_body %}
{% block self_js %}
<script type="text/javascript">
	function refresh(){
		window.location.href = '/login/';
	}
    var t1 = window.setInterval(checkStatus,1000); //每1秒请求一次
    function checkStatus(){
        $.ajax({
                method:"GET",
                url:"",
                dataType:"jsonp",
                jsonpCallback:"callback",   //jsonpCallback是实现跨域请求的时候定义回调函数用的 ，可以随意起名字
                success:function(data){
                    console.log(data);
                    if(data.errcode==0){
                        if(data.stage==9 || data.stage==-2){
                            console.log('登录成功');
                            setTimeout('',1000);
                            window.clearInterval(t1);
                            //登录后台跳转
                            window.location.href='/index/';
                        }else if(data.stage==0){
                            console.log('未扫码');
                            $('#info').text('二维码未扫描');
                        }else if(data.stage==1){
                            console.log('已扫码');
                            $('#info').text('已扫描二维码');
                        }else if(data.stage==-1){
                            console.log('二维码已过期');
                            $('#info').text('二维码已过期');
                            window.clearInterval(t1);
                        }
                    }else{
                        console.log('登录异常');
                        $('#info').text('登录异常');
                        window.clearInterval(t1);
                    }
                },
                error:function(data){
                },
                complete:function(){
                }
            })
    }

</script>
{% endblock self_js %}